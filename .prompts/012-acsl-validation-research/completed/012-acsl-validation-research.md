# ACSL Annotation Validation Research

<session_initialization>
Before beginning research, verify today's date:
!`date +%Y-%m-% d`

Use this date when searching for "current" or "latest" information.
</session_initialization>

<research_objective>
Research ACSL (ANSI/ISO C Specification Language) annotation generation and Frama-C integration in the C++ to C transpiler to ensure generated annotations are syntactically and semantically valid for formal verification.

Purpose: Enable formal verification of transpiled C code using Frama-C WP (Weakest Precondition) plugin
Scope: Current ACSL generation implementation, validation requirements, Frama-C integration points
Output: acsl-validation-research.md with structured findings for implementation planning
</research_objective>

<research_scope>
<include>
### Current Implementation Analysis
1. **ACSL Generation Code** (Epic #15 completed in v1.15.0)
   - Locate ACSL annotation generator files in src/
   - Review ACSLAnnotator, ACSLGenerator, or similar components
   - Understand which C++ constructs generate ACSL annotations
   - Identify annotation types generated (requires, ensures, invariant, assigns, etc.)

2. **Existing Validation**
   - Check if syntax validation exists
   - Look for Frama-C integration in tests/
   - Find verify_acsl.sh or similar validation scripts
   - Review test coverage for ACSL generation

3. **Known Issues**
   - Search for ACSL-related bugs, TODOs, or gaps in code
   - Check git commits for ACSL fixes or workarounds
   - Review documentation for known limitations

### ACSL Standard Requirements
4. **Syntax Requirements**
   - ACSL specification version supported
   - Required annotation structure (/*@ ... */)
   - Valid clause types and their syntax
   - Common syntax errors and how to avoid them

5. **Semantic Requirements**
   - Type consistency rules
   - Variable scope requirements
   - Valid logic expressions
   - Function contract completeness

### Frama-C Integration
6. **Frama-C Tool Requirements**
   - Minimum Frama-C version needed
   - Installation and dependencies
   - CLI interface for validation
   - Expected exit codes and error formats

7. **Integration Testing Approaches**
   - Unit test validation (syntax checking without Frama-C)
   - Integration test validation (Frama-C CLI in test suite)
   - CI/CD integration considerations
   - Performance impact of Frama-C validation

</include>

<exclude>
- Deep dive into Frama-C WP plugin (focus on validation, not proof)
- Alternative verification tools (stick to Frama-C as specified in Epic #15)
- ACSL code generation improvements (research validates existing, doesn't redesign)
- Formal proof techniques (out of scope for validation research)
</exclude>

<sources>
Official documentation:
- https://frama-c.com/html/acsl.html (ACSL specification)
- https://frama-c.com/html/documentation.html (Frama-C documentation)
- https://frama-c.com/download.html (installation guide)

Search queries for WebSearch:
- "ACSL annotation syntax validation 2025"
- "Frama-C CLI validation examples"
- "ACSL common syntax errors"
- "Frama-C integration testing"

Local codebase:
- @/Users/alexanderfedin/Projects/hapyy/hupyy-cpp-to-c/src/ (ACSL generator code)
- @/Users/alexanderfedin/Projects/hapyy/hupyy-cpp-to-c/tests/ (existing tests)
- @/Users/alexanderfedin/Projects/hapyy/hupyy-cpp-to-c/docs/ (Epic #15 documentation)
</sources>
</research_scope>

<verification_checklist>
□ Verify ALL ACSL annotation types generated by transpiler:
  □ Function contracts (requires, ensures)
  □ Loop annotations (loop invariant, loop variant, loop assigns)
  □ Assertions
  □ Memory specifications (assigns, allocates, frees)
  □ Other annotation types
□ Document exact file locations for ACSL generator components
□ Confirm Frama-C version compatibility
□ Verify syntax validation approaches (with/without Frama-C)
□ Check for recent ACSL standard updates

For all research:
□ Verify negative claims ("validation not implemented") with code search
□ Confirm all primary claims have evidence from code or docs
□ Check both current implementation AND Epic #15 completion docs
□ Test multiple search patterns to find ACSL-related code
□ Check for transpiler-specific ACSL extensions or limitations
</verification_checklist>

<research_quality_assurance>
Before completing research, perform these checks:

<completeness_check>
- [ ] All ACSL annotation types identified and documented
- [ ] Both syntax and semantic validation requirements covered
- [ ] Frama-C integration approaches evaluated
- [ ] Existing implementation gaps clearly identified
</completeness_check>

<source_verification>
- [ ] Code locations verified with actual file reads
- [ ] ACSL standard version confirmed from official docs
- [ ] Frama-C CLI usage verified with official documentation
- [ ] Distinguish verified implementation from inferred behavior
</source_verification>

<blind_spots_review>
Ask yourself: "What might I have missed?"
- [ ] Are there ACSL generator files I didn't find?
- [ ] Did I check for validation code in unexpected locations (scripts/, tools/)?
- [ ] Did I verify both unit and integration test approaches?
- [ ] Did I look for Frama-C wrapper scripts or helper tools?
</blind_spots_review>

<critical_claims_audit>
For any statement like "no validation exists" or "Frama-C not integrated":
- [ ] Verified by searching codebase thoroughly?
- [ ] Checked git history for removed validation code?
- [ ] Considered alternative implementation approaches?
</critical_claims_audit>
</research_quality_assurance>

<output_structure>
Save to: `.prompts/012-acsl-validation-research/acsl-validation-research.md`

Structure findings using this XML format:

```xml
<research>
  <summary>
    Executive summary of current ACSL generation status, validation gaps, and Frama-C integration requirements.
  </summary>

  <findings>
    <finding category="current-implementation">
      <title>ACSL Generation Components</title>
      <detail>Files, classes, methods responsible for ACSL annotation generation</detail>
      <source>Code locations and git commits</source>
      <relevance>Understanding what exists before adding validation</relevance>
    </finding>

    <finding category="validation-gaps">
      <title>Missing Validation</title>
      <detail>What syntax/semantic checks are NOT currently performed</detail>
      <source>Code analysis and test coverage review</source>
      <relevance>Identifies scope of validation work needed</relevance>
    </finding>

    <finding category="frama-c-integration">
      <title>Frama-C Integration Status</title>
      <detail>Current integration level, if any</detail>
      <source>Test suite analysis, script search</source>
      <relevance>Determines integration testing approach</relevance>
    </finding>

    <!-- Additional findings as discovered -->
  </findings>

  <recommendations>
    <recommendation priority="high">
      <action>Immediate validation requirements</action>
      <rationale>Critical for correctness</rationale>
    </recommendation>

    <recommendation priority="medium">
      <action>Integration testing approach</action>
      <rationale>Enables automated verification</rationale>
    </recommendation>
  </recommendations>

  <code_examples>
    {Sample ACSL annotations from codebase}
    {Frama-C CLI invocation patterns}
    {Test structure examples}
  </code_examples>

  <metadata>
    <confidence level="high|medium|low">
      Confidence based on code review completeness and documentation quality
    </confidence>
    <dependencies>
      - Frama-C installation (version X.Y+)
      - ACSL standard knowledge
      - Test framework integration
    </dependencies>
    <open_questions>
      - Performance impact of Frama-C in CI/CD?
      - ACSL version compatibility across Frama-C versions?
      - Handling of transpiler-specific annotations?
    </open_questions>
    <assumptions>
      - Epic #15 implementation is complete and correct
      - Frama-C CLI is the validation tool of choice
      - Test suite can accommodate Frama-C calls
    </assumptions>

    <quality_report>
      <sources_consulted>
        - ACSL specification (URL)
        - Frama-C documentation (URL)
        - Transpiler source code (file list)
        - Epic #15 completion docs (file list)
      </sources_consulted>
      <claims_verified>
        - ACSL generator files exist at [locations]
        - Epic #15 completed in v1.15.0 (git tag evidence)
        - Frama-C CLI syntax: frama-c -wp file.c
      </claims_verified>
      <claims_assumed>
        - Annotations generated are mostly syntactically correct
        - No systematic validation currently exists
      </claims_assumed>
      <contradictions_encountered>
        {Any conflicts between code and documentation}
      </contradictions_encountered>
      <confidence_by_finding>
        - Current implementation: High (code reviewed)
        - Validation gaps: Medium (inferred from test absence)
        - Integration approach: Medium (Frama-C docs + best practices)
      </confidence_by_finding>
    </quality_report>
  </metadata>
</research>
```
</output_structure>

<pre_submission_checklist>
Before submitting your research report, confirm:

**Scope Coverage**
- [ ] All ACSL annotation types documented
- [ ] Both syntax and semantic validation covered
- [ ] Frama-C integration requirements identified
- [ ] Code locations verified with file reads

**Claim Verification**
- [ ] "No validation" claims backed by thorough code search
- [ ] ACSL standard version confirmed from official docs
- [ ] Frama-C requirements verified from official documentation

**Quality Controls**
- [ ] Blind spots review completed
- [ ] Quality report section filled honestly
- [ ] Confidence levels justified
- [ ] Verified facts distinguished from assumptions

**Output Completeness**
- [ ] All required XML sections present
- [ ] SUMMARY.md created with substantive one-liner
- [ ] Sources listed with URLs
- [ ] Next steps identified for planning phase
</pre_submission_checklist>

<summary_md_requirements>
Create `.prompts/012-acsl-validation-research/SUMMARY.md` with:

**One-liner**: Substantive finding (e.g., "ACSL generation complete but lacks Frama-C validation in test suite")

**Key Findings**:
- Current ACSL implementation status
- Validation gaps identified
- Frama-C integration requirements

**Decisions Needed**: None (research provides input for planning)

**Blockers**: Any external dependencies (Frama-C installation, etc.)

**Next Step**: Create acsl-validation-plan.md
</summary_md_requirements>
