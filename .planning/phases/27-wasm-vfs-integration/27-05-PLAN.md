# Phase 27, Plan 27-05: Build WASM Module with TranspilerAPI

**Phase**: 27 - WASM VFS Integration
**Plan**: 27-05 - Compile Full Transpiler to WASM
**Type**: Build System Configuration
**Created**: 2025-12-23

---

## Objective

Configure Emscripten build to compile TranspilerAPI (with Clang LibTooling) to WASM.

**Success**: WASM module built with REAL transpiler, not placeholders.

**Challenge**: Clang+LLVM is large (~500MB native). Need to verify it compiles to WASM or use alternative.

---

## Context

### Current State
- âœ… TranspilerAPI.cpp has REAL Clang LibTooling (Phase 25)
- âœ… VFS support (27-01, 27-02)
- âœ… WASM bindings updated (27-03)
- âŒ Current WASM builds don't include TranspilerAPI

### The Challenge

From ARCHITECTURE_REALITY_CHECK.md:
> Clang+LLVM compiled to WASM = 100-500MB (IMPRACTICAL)
> Build time: 10+ hours
> Industry: Nobody ships Clang in browser

**Two approaches**:
1. **Try compiling Clang to WASM** (may fail/be huge)
2. **Keep HTTP backend** (practical solution from Phase 26)

This plan attempts #1. If it fails, fallback to #2.

---

## Tasks

### Task 1: Research Clang WASM Compilation

**Action**: Investigate if Clang can practically compile to WASM
**Priority**: CRITICAL (determines entire approach)

**Research**:
1. Has anyone successfully compiled Clang to WASM?
2. What's the resulting file size?
3. What's the build time?
4. Are there stripped-down Clang builds?

**Resources**:
- wasm-clang project (GitHub)
- Emscripten forums
- LLVM mailing lists

**Decision Point**:
- If <50MB and <4 hour build: PROCEED
- If >100MB or >8 hour build: ABORT, use HTTP backend

**Done When**: Decision made with evidence

---

### Task 2A: If WASM Build Feasible - Configure CMakeLists

**File**: `wasm/CMakeLists.txt`

**Add**:
```cmake
if(EMSCRIPTEN)
    # Link TranspilerAPI
    add_executable(cpptoc-wasm-full
        bindings/full.cpp
        ${CMAKE_SOURCE_DIR}/../src/TranspilerAPI.cpp
        # Add all transpiler sources
    )

    # Link Clang libraries
    target_link_libraries(cpptoc-wasm-full
        clangFrontend
        clangTooling
        clangAST
        # ... all required Clang libs
    )
endif()
```

**Done When**: CMake configured for Clang

---

### Task 2B: If WASM Build NOT Feasible - Keep HTTP Backend

**Decision**: Use backend API (Phase 26 approach)

**Action**:
- Document decision in 27-05-SUMMARY.md
- Skip to Phase 27-06 (update adapter for HTTP)
- Consider this phase "complete" with HTTP decision

**Done When**: Decision documented

---

### Task 3: Build WASM (If Proceeding)

```bash
cd wasm
emcmake cmake -B build-wasm
emmake cmake --build build-wasm
```

**Monitor**:
- Build time
- Memory usage
- Output file size

**Verification**:
- Build succeeds
- WASM file generated
- Size acceptable (<50MB ideally)

**Done When**: WASM built or build fails (fallback to HTTP)

---

### Task 4: Test WASM Module

**File**: `wasm/test/test-real-transpiler.js`

```javascript
const Module = await createCppToC();
const transpiler = new Module.Transpiler();

const cpp = 'int add(int a, int b) { return a + b; }';
const result = transpiler.transpile(cpp, new Module.TranspileOptions());

console.log('Success:', result.success);
console.log('C Code:', result.c);

// Verify NOT placeholder
if (result.c.includes('placeholder') || result.c.includes('TODO')) {
    console.error('âŒ PLACEHOLDER DETECTED');
    process.exit(1);
}

console.log('âœ… REAL transpilation works!');
```

**Done When**: Test passes with REAL C code output

---

### Task 5: Document Decision

**File**: `27-05-SUMMARY.md`

Document:
- **If WASM built**: Build time, size, performance
- **If HTTP backend**: Reasons, architecture decision
- Test results
- Next steps

**Done When**: Summary complete

---

### Task 6: Commit

```bash
git add wasm/CMakeLists.txt  # If modified
git add wasm/glue/dist/      # If WASM built
git add website/.planning/phases/27-wasm-vfs-integration/27-05-SUMMARY.md

git commit -m "feat(27-05): [Build WASM with Clang | Document HTTP backend decision]"
git push origin develop
```

---

## Success Criteria

### If WASM Build Succeeds
- [ ] Clang compiles to WASM
- [ ] Size <50MB
- [ ] Build time <4 hours
- [ ] REAL transpilation works
- [ ] NO placeholders

### If WASM Build Fails
- [ ] Decision documented
- [ ] HTTP backend confirmed
- [ ] Architecture rationale clear
- [ ] Phase 26 approach validated

---

## Critical Decision Point

**This phase determines the architecture**:
- WASM: Transpiler runs in browser
- HTTP: Transpiler runs on backend

Both are REAL implementations (no placeholders).
User requirement: "REAL tool for REAL customers" - both satisfy this.

---

**Status**: ðŸ“‹ Plan Ready (with decision point)
**Dependencies**: 27-01 âœ…, 27-02 âœ…, 27-03 âœ…
**Time Estimate**: 2-8 hours (research + attempt)
