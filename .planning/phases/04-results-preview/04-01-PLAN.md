# Phase 4, Plan 04-01: Dual-Pane Viewer Layout

**Phase**: 04 - Results Preview & Download
**Plan**: 04-01 - Dual-Pane Viewer Layout
**Scope**: Split-pane component with resizable source/result display using react-resizable-panels
**Estimate**: 1-2 hours

---

## Objective

Create a dual-pane file viewer component using the battle-tested `react-resizable-panels` library to provide side-by-side display of original C++ source code and transpiled C output with user-controlled resizing.

**Why**: Establishes the visual foundation for Step 4 Results, allowing users to compare source and transpiled code side-by-side. Using react-resizable-panels (4.3M/week downloads, updated daily) instead of building from scratch provides a modern, accessible, smooth resizing experience.

---

## Context

**Existing code to understand:**
- `@src/components/playground/wizard/Step4Results.tsx` - shell component where dual-pane viewer will be integrated
- `@src/components/playground/wizard/types.ts` - WizardState interface with transpilationResults and selectedPreviewFile
- `@src/components/playground/wizard/FileTreeView.tsx` - tree view component to reuse for target directory
- `@src/components/playground/ErrorDisplay.tsx` - CSS-in-JS styling pattern to follow

**Patterns to follow:**
- React 19 with TypeScript (existing pattern)
- CSS-in-JS for styling (existing pattern in all current components)
- Component tests with Vitest and @testing-library/react (existing pattern)
- Export via index.ts barrel file (existing pattern)

**New dependency:**
- `react-resizable-panels@^2.1.7` - Modern split-pane component (4.3M/week, actively maintained)

**Key Requirements:**
- Left pane: Original C++ source code
- Right pane: Transpiled C output
- Resizable split with drag handle
- Minimum pane sizes (prevent collapse to 0)
- Synchronized scrolling (optional, can be added later)
- File content display with line numbers
- Empty state when no file selected

---

## Tasks

### Task 1: Install react-resizable-panels
**Type**: dependency
**Files**: `package.json`, `package-lock.json`

**Action**:
```bash
npm install react-resizable-panels
```

**Verify**:
- Package appears in package.json dependencies
- No version conflicts with React 19
- No peer dependency warnings

**Done**: ✅ Dependency installed and no conflicts

---

### Task 2: Create FileContentDisplay Component
**Type**: create
**Files**: `src/components/playground/wizard/FileContentDisplay.tsx`

**Action**:
Create a component to display file content with line numbers (no syntax highlighting yet):

```typescript
import React from 'react';

export interface FileContentDisplayProps {
  content: string;
  filename?: string;
  language?: 'cpp' | 'c'; // For future syntax highlighting integration
  lineNumbers?: boolean;
  emptyMessage?: string;
}

export const FileContentDisplay: React.FC<FileContentDisplayProps> = ({
  content,
  filename,
  language = 'cpp',
  lineNumbers = true,
  emptyMessage = 'No file selected',
}) => {
  // Split content into lines for line number rendering
  const lines = React.useMemo(() => content.split('\n'), [content]);

  // Empty state
  if (!content || content.trim() === '') {
    return (
      <div className="file-content-empty">
        <p>{emptyMessage}</p>

        <style>{`
          .file-content-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
            font-size: 0.95rem;
            font-style: italic;
          }
        `}</style>
      </div>
    );
  }

  return (
    <div className="file-content-display">
      {/* Header with filename */}
      {filename && (
        <div className="file-content-header">
          <span className="file-content-filename">{filename}</span>
          <span className="file-content-language">{language.toUpperCase()}</span>
        </div>
      )}

      {/* Content area */}
      <div className="file-content-wrapper">
        <pre className="file-content-code">
          {lineNumbers && (
            <div className="line-numbers">
              {lines.map((_, index) => (
                <div key={index} className="line-number">
                  {index + 1}
                </div>
              ))}
            </div>
          )}
          <div className="code-lines">
            <code>{content}</code>
          </div>
        </pre>
      </div>

      <style>{`
        .file-content-display {
          display: flex;
          flex-direction: column;
          height: 100%;
          background-color: #fafafa;
          border-radius: 4px;
          overflow: hidden;
        }

        .file-content-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background-color: #f5f5f5;
          border-bottom: 1px solid #e0e0e0;
        }

        .file-content-filename {
          font-size: 0.9rem;
          font-weight: 600;
          color: #333;
        }

        .file-content-language {
          font-size: 0.75rem;
          font-weight: 600;
          color: #666;
          background-color: #e0e0e0;
          padding: 0.25rem 0.5rem;
          border-radius: 3px;
        }

        .file-content-wrapper {
          flex: 1;
          overflow: auto;
          background-color: #fff;
        }

        .file-content-code {
          display: flex;
          margin: 0;
          padding: 0;
          font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
          font-size: 0.9rem;
          line-height: 1.6;
          min-height: 100%;
        }

        .line-numbers {
          display: flex;
          flex-direction: column;
          background-color: #f5f5f5;
          color: #999;
          padding: 1rem 0.75rem;
          text-align: right;
          user-select: none;
          border-right: 1px solid #e0e0e0;
          min-width: 3rem;
        }

        .line-number {
          height: 1.6em;
        }

        .code-lines {
          flex: 1;
          padding: 1rem;
          overflow-x: auto;
        }

        .code-lines code {
          display: block;
          white-space: pre;
          font-family: inherit;
          font-size: inherit;
          line-height: inherit;
        }
      `}</style>
    </div>
  );
};
```

**Component features:**
1. Displays file content with line numbers
2. Header shows filename and language badge
3. Empty state for when no file is selected
4. Horizontal scrolling for long lines
5. Vertical scrolling for long files
6. Monospace font for code display
7. Follows existing CSS-in-JS pattern

**Verify**:
- Component renders with content
- Line numbers align with code lines
- Header displays filename and language
- Empty state shows when content is empty
- Scrolling works for overflow content
- No TypeScript errors

**Done**: ✅ FileContentDisplay component created

---

### Task 3: Create DualPaneViewer Component
**Type**: create
**Files**: `src/components/playground/wizard/DualPaneViewer.tsx`

**Action**:
Create split-pane viewer using react-resizable-panels:

```typescript
import React from 'react';
import { Panel, PanelGroup, PanelResizeHandle } from 'react-resizable-panels';
import { FileContentDisplay } from './FileContentDisplay';

export interface DualPaneViewerProps {
  sourceContent: string;
  sourceFilename?: string;
  transpileContent: string;
  transpileFilename?: string;
  defaultLayout?: number[]; // [leftPercent, rightPercent]
}

export const DualPaneViewer: React.FC<DualPaneViewerProps> = ({
  sourceContent,
  sourceFilename,
  transpileContent,
  transpileFilename,
  defaultLayout = [50, 50],
}) => {
  return (
    <div className="dual-pane-viewer">
      <PanelGroup direction="horizontal">
        {/* Left pane: Source C++ */}
        <Panel defaultSize={defaultLayout[0]} minSize={20}>
          <div className="pane-container">
            <FileContentDisplay
              content={sourceContent}
              filename={sourceFilename}
              language="cpp"
              emptyMessage="No source file selected"
            />
          </div>
        </Panel>

        {/* Resize handle */}
        <PanelResizeHandle className="resize-handle">
          <div className="resize-handle-line" />
        </PanelResizeHandle>

        {/* Right pane: Transpiled C */}
        <Panel defaultSize={defaultLayout[1]} minSize={20}>
          <div className="pane-container">
            <FileContentDisplay
              content={transpileContent}
              filename={transpileFilename}
              language="c"
              emptyMessage="No transpiled output"
            />
          </div>
        </Panel>
      </PanelGroup>

      <style>{`
        .dual-pane-viewer {
          height: 100%;
          width: 100%;
          background-color: #fff;
          border: 1px solid #ddd;
          border-radius: 8px;
          overflow: hidden;
        }

        .pane-container {
          height: 100%;
          padding: 0.5rem;
        }

        .resize-handle {
          position: relative;
          display: flex;
          align-items: center;
          justify-content: center;
          background-color: #f0f0f0;
          cursor: col-resize;
          transition: background-color 0.2s;
          width: 8px;
        }

        .resize-handle:hover {
          background-color: #4A90E2;
        }

        .resize-handle:active {
          background-color: #1976d2;
        }

        .resize-handle-line {
          width: 2px;
          height: 100%;
          background-color: #ddd;
          pointer-events: none;
        }

        .resize-handle:hover .resize-handle-line {
          background-color: #fff;
        }
      `}</style>
    </div>
  );
};
```

**Component features:**
1. Uses react-resizable-panels for smooth resizing
2. Left pane shows original C++ source
3. Right pane shows transpiled C output
4. Visible drag handle between panes
5. Minimum pane size prevents collapse (20%)
6. Configurable default layout (50/50 split)
7. Hover effects on resize handle

**Accessibility:**
- Keyboard accessible (react-resizable-panels provides this)
- Screen reader support for resize handle
- ARIA labels for panes

**Verify**:
- Both panes render side-by-side
- Drag handle resizes panes smoothly
- Minimum sizes respected (can't collapse)
- Hover effects work on resize handle
- FileContentDisplay renders in both panes
- No TypeScript errors

**Done**: ✅ DualPaneViewer component created

---

### Task 4: Component Tests
**Type**: test
**Files**: `src/components/playground/wizard/FileContentDisplay.test.tsx`, `DualPaneViewer.test.tsx`

**Action**:
Create unit tests for both components:

**FileContentDisplay.test.tsx**:
```typescript
import { render, screen } from '@testing-library/react';
import { FileContentDisplay } from './FileContentDisplay';

describe('FileContentDisplay', () => {
  it('renders file content with line numbers', () => {
    const content = 'line 1\nline 2\nline 3';
    render(<FileContentDisplay content={content} />);

    expect(screen.getByText('line 1')).toBeInTheDocument();
    expect(screen.getByText('1')).toBeInTheDocument();
    expect(screen.getByText('2')).toBeInTheDocument();
    expect(screen.getByText('3')).toBeInTheDocument();
  });

  it('displays filename in header', () => {
    render(
      <FileContentDisplay
        content="test"
        filename="example.cpp"
      />
    );

    expect(screen.getByText('example.cpp')).toBeInTheDocument();
  });

  it('displays language badge', () => {
    render(
      <FileContentDisplay
        content="test"
        language="cpp"
      />
    );

    expect(screen.getByText('CPP')).toBeInTheDocument();
  });

  it('shows empty state when no content', () => {
    render(<FileContentDisplay content="" />);

    expect(screen.getByText('No file selected')).toBeInTheDocument();
  });

  it('shows custom empty message', () => {
    render(
      <FileContentDisplay
        content=""
        emptyMessage="Custom message"
      />
    );

    expect(screen.getByText('Custom message')).toBeInTheDocument();
  });

  it('renders without line numbers when disabled', () => {
    const content = 'line 1\nline 2';
    const { container } = render(
      <FileContentDisplay content={content} lineNumbers={false} />
    );

    expect(container.querySelector('.line-numbers')).not.toBeInTheDocument();
  });

  it('handles single line content', () => {
    render(<FileContentDisplay content="single line" />);

    expect(screen.getByText('single line')).toBeInTheDocument();
    expect(screen.getByText('1')).toBeInTheDocument();
  });

  it('handles empty lines in content', () => {
    const content = 'line 1\n\nline 3';
    render(<FileContentDisplay content={content} />);

    // Should have 3 line numbers
    expect(screen.getByText('1')).toBeInTheDocument();
    expect(screen.getByText('2')).toBeInTheDocument();
    expect(screen.getByText('3')).toBeInTheDocument();
  });
});
```

**DualPaneViewer.test.tsx**:
```typescript
import { render, screen } from '@testing-library/react';
import { DualPaneViewer } from './DualPaneViewer';

describe('DualPaneViewer', () => {
  it('renders both source and transpile panes', () => {
    render(
      <DualPaneViewer
        sourceContent="// C++ source"
        transpileContent="// C output"
      />
    );

    expect(screen.getByText('// C++ source')).toBeInTheDocument();
    expect(screen.getByText('// C output')).toBeInTheDocument();
  });

  it('displays filenames in headers', () => {
    render(
      <DualPaneViewer
        sourceContent="source"
        sourceFilename="test.cpp"
        transpileContent="output"
        transpileFilename="test.c"
      />
    );

    expect(screen.getByText('test.cpp')).toBeInTheDocument();
    expect(screen.getByText('test.c')).toBeInTheDocument();
  });

  it('shows empty states when no content', () => {
    render(
      <DualPaneViewer
        sourceContent=""
        transpileContent=""
      />
    );

    expect(screen.getByText('No source file selected')).toBeInTheDocument();
    expect(screen.getByText('No transpiled output')).toBeInTheDocument();
  });

  it('renders resize handle', () => {
    const { container } = render(
      <DualPaneViewer
        sourceContent="source"
        transpileContent="output"
      />
    );

    const handle = container.querySelector('.resize-handle');
    expect(handle).toBeInTheDocument();
  });

  it('applies default layout', () => {
    const { container } = render(
      <DualPaneViewer
        sourceContent="source"
        transpileContent="output"
        defaultLayout={[60, 40]}
      />
    );

    // Verify panels exist (detailed layout testing may require more setup)
    const panels = container.querySelectorAll('[data-panel]');
    expect(panels.length).toBe(2);
  });
});
```

**Test coverage goals:**
- FileContentDisplay: line numbers, headers, empty states, edge cases
- DualPaneViewer: pane rendering, resize handle, layout
- Target: >80% coverage

**Verify**:
- All tests pass
- Coverage report shows >80%
- No console errors during test run
- Tests run in CI (npm test)

**Done**: ✅ Tests written and passing

---

### Task 5: Export and Documentation
**Type**: update
**Files**: `src/components/playground/wizard/index.ts`

**Action**:
Add new components to barrel exports:

```typescript
// src/components/playground/wizard/index.ts

// ... existing exports ...

export { FileContentDisplay } from './FileContentDisplay';
export type { FileContentDisplayProps } from './FileContentDisplay';
export { DualPaneViewer } from './DualPaneViewer';
export type { DualPaneViewerProps } from './DualPaneViewer';
```

**Documentation:**
Add JSDoc comments to components:

```typescript
/**
 * FileContentDisplay - Displays file content with line numbers and optional syntax highlighting
 *
 * @example Basic usage
 * ```tsx
 * <FileContentDisplay
 *   content={sourceCode}
 *   filename="main.cpp"
 *   language="cpp"
 * />
 * ```
 */

/**
 * DualPaneViewer - Side-by-side comparison of source and transpiled code
 *
 * @example
 * ```tsx
 * <DualPaneViewer
 *   sourceContent={cppCode}
 *   sourceFilename="example.cpp"
 *   transpileContent={cCode}
 *   transpileFilename="example.c"
 *   defaultLayout={[50, 50]}
 * />
 * ```
 */
```

**Verify**:
- Exports work correctly
- TypeScript autocomplete shows new components
- JSDoc appears in IDE tooltips
- No circular dependencies

**Done**: ✅ Components exported and documented

---

### Task 6: Manual Testing in Browser
**Type**: manual test
**Files**: N/A (browser testing)

**Action**:
Add DualPaneViewer to Step4Results with mock data for testing:

```typescript
// Temporary test code in Step4Results.tsx
const mockSource = `#include <iostream>

int main() {
    std::cout << "Hello, World!" << std::endl;
    return 0;
}`;

const mockTranspile = `#include <stdio.h>

int main(void) {
    printf("Hello, World!\\n");
    return 0;
}`;

<DualPaneViewer
  sourceContent={mockSource}
  sourceFilename="example.cpp"
  transpileContent={mockTranspile}
  transpileFilename="example.c"
/>
```

**Browser testing checklist:**
1. Start dev server: `npm run dev`
2. Navigate to playground → Step 4 (wizard)
3. Verify in browser:
   - ✅ Two panes display side-by-side
   - ✅ Left pane shows C++ code with "CPP" badge
   - ✅ Right pane shows C code with "C" badge
   - ✅ Line numbers display correctly in both panes
   - ✅ Filenames appear in headers
   - ✅ Drag handle visible between panes
   - ✅ Can drag handle to resize panes
   - ✅ Panes don't collapse below 20% width
   - ✅ Hover effect on resize handle works
   - ✅ Scrolling works in both panes independently
   - ✅ No console errors
   - ✅ No visual glitches

**Performance checks:**
- ✅ Resizing is smooth (60fps)
- ✅ No lag when scrolling long files
- ✅ Layout stable (no shifts)

**Verify**:
- All visual checks pass
- Resize interaction feels smooth
- No console warnings or errors

**Done**: ✅ Manual browser testing complete

---

## Verification

**Overall checks after all tasks complete:**

1. ✅ `npm install` succeeds with react-resizable-panels
2. ✅ `npm run test` passes all tests (FileContentDisplay + DualPaneViewer)
3. ✅ `npm run build` succeeds without errors
4. ✅ `npm run dev` starts without errors
5. ✅ Navigate to http://localhost:4321/cpp-to-c-website/playground
6. ✅ Navigate to Step 4 in wizard
7. ✅ See dual-pane viewer with mock source and transpile code
8. ✅ Both panes display side-by-side with 50/50 split
9. ✅ Line numbers align with code in both panes
10. ✅ Can drag resize handle to adjust pane sizes
11. ✅ Minimum pane size enforced (20%)
12. ✅ Hover effects work on resize handle
13. ✅ Independent scrolling in each pane
14. ✅ Filenames and language badges display
15. ✅ No TypeScript errors in IDE
16. ✅ No console errors in browser

---

## Success Criteria

- [x] react-resizable-panels installed and working
- [x] FileContentDisplay component renders code with line numbers
- [x] FileContentDisplay shows filename and language badge
- [x] FileContentDisplay handles empty state
- [x] DualPaneViewer uses react-resizable-panels for split layout
- [x] Dual panes display source (left) and transpile (right) content
- [x] Resize handle between panes is visible and functional
- [x] Minimum pane sizes prevent collapse
- [x] Hover effects on resize handle
- [x] Unit tests pass with >80% coverage
- [x] Components follow existing patterns (React 19, TypeScript, CSS-in-JS)
- [x] Exports via barrel file
- [x] JSDoc documentation complete
- [x] Manual browser testing confirms functionality
- [x] All existing tests still pass (no regressions)

---

## Output: SUMMARY.md

When this plan is complete, create `04-01-SUMMARY.md` with:

```markdown
# Phase 4, Plan 04-01: Dual-Pane Viewer Layout - COMPLETE

**Status**: ✅ Complete
**Completed**: [date]
**Duration**: [actual time]

## What Was Built

- Installed react-resizable-panels (4.3M/week downloads)
- Created FileContentDisplay component with line numbers and headers
- Created DualPaneViewer component with resizable split layout
- Implemented resize handle with hover effects
- Added empty states for both panes
- Created comprehensive unit tests for both components
- Exported components via barrel file with TypeScript types
- Added JSDoc documentation with usage examples

## Files Changed

- `package.json` - Added react-resizable-panels dependency
- `src/components/playground/wizard/FileContentDisplay.tsx` - NEW (X lines)
- `src/components/playground/wizard/FileContentDisplay.test.tsx` - NEW (X lines)
- `src/components/playground/wizard/DualPaneViewer.tsx` - NEW (X lines)
- `src/components/playground/wizard/DualPaneViewer.test.tsx` - NEW (X lines)
- `src/components/playground/wizard/index.ts` - Updated exports

## Tests

- Unit tests: X passing, 0 failing
- FileContentDisplay tests: X passing
- DualPaneViewer tests: X passing
- Coverage: X% (target: >80%)

## Verification

✅ All success criteria met
✅ No regressions in existing tests
✅ Dual-pane viewer works smoothly in browser
✅ Resize interaction is responsive and smooth
✅ Line numbers align correctly with code

## Public Components Used

- **react-resizable-panels** (v2.1.7) - Modern split-pane library
  - 4.3M weekly downloads
  - Updated daily (actively maintained)
  - Provides smooth resizing with keyboard accessibility
  - Built-in ARIA support

## Deviations from Plan

[None] OR [List any changes made during implementation]

## Next Steps

Ready for **04-02**: Syntax Highlighting
- Install prism-react-renderer
- Create SyntaxHighlighter wrapper component
- Add async loading for large files
- Support C++ and C languages
- Integrate into FileContentDisplay

## Commits

- `[commit-hash]` feat(04-01): Add react-resizable-panels and FileContentDisplay
- `[commit-hash]` feat(04-01): Create DualPaneViewer with resizable split layout
- `[commit-hash]` test(04-01): Add tests for FileContentDisplay and DualPaneViewer
- `[commit-hash]` docs(04-01): Export components and add JSDoc
```

---

**Ready to execute**: Run this plan with `/run-plan .planning/phases/04-results-preview/04-01-PLAN.md`
