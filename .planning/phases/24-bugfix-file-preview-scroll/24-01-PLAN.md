# Phase 24, Plan 24-01: Fix File Preview Panel Scroll Behavior

**Phase**: 24 - Bugfix: File preview panel does not scroll
**Plan**: 24-01 - Fix SyntaxHighlighter height constraint preventing scroll
**Type**: Bugfix
**Estimate**: 15 minutes
**Created**: 2025-12-22

---

## Objective

Fix the file preview panel to enable proper vertical and horizontal scrolling for code content.

**Why This Matters**:
- User reports file preview panel does not scroll
- HTML shows all 38 lines rendered but not scrollable
- Users cannot view content beyond viewport
- Poor UX - cannot see full file content

**Success**: File preview panel scrolls vertically and horizontally to show all content

---

## Context

### Current State (Broken)

**User Report**: "the file preview panel does not scroll"

**HTML Analysis**:
```html
<div class="file-content-wrapper">  <!-- flex: 1, overflow: auto -->
  <div class="syntax-highlighter">  <!-- height: 100%, overflow: auto -->
    <pre>
      <!-- All 38 lines rendered -->
    </pre>
  </div>
</div>
```

**CSS Inspection**:
```css
/* FileContentDisplay.tsx */
.file-content-wrapper {
  flex: 1;
  overflow: auto;      /* ✅ Parent has overflow */
  background-color: #fff;
}

/* SyntaxHighlighter.tsx */
.syntax-highlighter {
  height: 100%;        /* ❌ Problem: child matches parent height */
  overflow: auto;      /* ⚠️ Redundant with parent overflow */
}
```

**Root Cause**:
When `.syntax-highlighter` has `height: 100%`:
- It tries to be 100% of parent's height
- Parent `.file-content-wrapper` has `flex: 1` (grows to fill space)
- Child grows to match parent's content height (not constrained height)
- Parent's `overflow: auto` never triggers because child isn't overflowing
- Scrollbar doesn't appear

**The Problem**:
`.syntax-highlighter` with `height: 100%` makes it always match parent height, preventing the overflow condition that would trigger scrolling.

---

## Root Cause Analysis

### Issue: `.syntax-highlighter` Height Prevents Overflow

**Location**: `SyntaxHighlighter.tsx:119-122`

**Current CSS**:
```css
.syntax-highlighter {
  height: 100%;
  overflow: auto;
}
```

**Why This Breaks Scrolling**:
1. Parent `.file-content-wrapper` has `flex: 1` → grows to fill available space
2. Child `.syntax-highlighter` has `height: 100%` → matches parent height
3. If parent is 500px tall, child becomes exactly 500px tall
4. Pre element with 38 lines (38 * 1.6em ≈ 60.8em ≈ 970px) renders inside
5. Child is fixed at 500px but contains 970px of content
6. Child's `overflow: auto` should trigger BUT doesn't because of flex behavior
7. No scrollbar appears

**The Fix**:
Remove `height: 100%` from `.syntax-highlighter`:
- Let it be a normal block element
- Parent `.file-content-wrapper` with `overflow: auto` handles scroll
- Content overflows parent → scrollbar appears

**Alternative Understanding**:
The scroll should happen in the parent (`.file-content-wrapper`), not the child. The child with `height: 100%` is trying to force itself to be 100% of parent, which prevents the parent from scrolling its overflowing content.

---

## Tasks

### Task 1: Remove Height Constraint from SyntaxHighlighter
**Type**: CSS Fix
**Action**: Remove `height: 100%` to enable parent overflow scrolling
**Files**: `src/components/playground/wizard/SyntaxHighlighter.tsx`

**Steps**:
1. Read SyntaxHighlighter.tsx (lines 118-123)
2. Find `.syntax-highlighter` CSS block
3. Remove `height: 100%;` line
4. Keep `overflow: auto;` for horizontal scroll of long lines

**Before** (line 119-122):
```css
.syntax-highlighter {
  height: 100%;
  overflow: auto;
}
```

**After**:
```css
.syntax-highlighter {
  overflow: auto;
}
```

**Why This Works**:
- Parent `.file-content-wrapper` has `flex: 1` and `overflow: auto`
- Child `.syntax-highlighter` without height constraint grows naturally
- When child content exceeds parent's flexbox-allocated height
- Parent's `overflow: auto` triggers
- Scrollbar appears in parent container
- User can scroll to see all content

**Verify**:
- ✅ TypeScript compiles
- ✅ File preview shows scrollbar when content exceeds viewport
- ✅ Vertical scrolling works
- ✅ Horizontal scrolling works for long lines

**Done When**: SyntaxHighlighter.tsx updated, compiles

---

### Task 2: Verify Scroll Chain
**Type**: Verification
**Action**: Confirm scroll works through component hierarchy
**Files**: None (code review)

**Scroll Chain**:
1. **Step4Results** `.results-viewer`:
   - `height: 100%` (ALREADY FIXED in separate commit)
   - Constrains to grid cell

2. **TabbedCodeViewer** `.tabbed-code-viewer`:
   - `height: 100%`
   - `overflow: hidden`

3. **TabbedCodeViewer** `.tab-content`:
   - `flex: 1`
   - `overflow: auto`

4. **FileContentDisplay** `.file-content-display`:
   - `height: 100%`
   - `display: flex; flex-direction: column`
   - `overflow: hidden`

5. **FileContentDisplay** `.file-content-wrapper`:
   - `flex: 1`
   - `overflow: auto` ← SCROLLING HAPPENS HERE

6. **SyntaxHighlighter** `.syntax-highlighter`:
   - `overflow: auto` (AFTER FIX - no height constraint)
   - Grows naturally, parent handles scroll

**Result**: Parent `.file-content-wrapper` scrolls when content overflows

**Done When**: Verified scroll chain in code review

---

### Task 3: Manual Browser Testing
**Type**: Testing
**Action**: Verify scrolling works in browser
**Files**: None (browser testing)

**Steps**:
1. Dev server should hot-reload automatically
2. Open: http://localhost:4321/cpp-to-c-website/playground
3. Complete transpilation to reach Step 4 (Results)
4. Select a file with many lines (e.g., gmock-matchers.h with 38 lines)
5. **Verify Vertical Scrolling**:
   - ✅ Scrollbar appears on right side
   - ✅ Can scroll down to see all 38 lines
   - ✅ Line numbers visible for all lines
6. Select a file with long lines
7. **Verify Horizontal Scrolling**:
   - ✅ Horizontal scrollbar appears if needed
   - ✅ Can scroll right to see full lines

**Expected Behavior**:
```
┌─[C++ Source]─[C Transpiled]─────────────────┐
│ gmock-matchers.h                        CPP │
├─────────────────────────────────────────────┤
│ 1  // Copyright 2015, Google Inc.          │[▲]
│ 2  // All rights reserved.                 │ │
│ 3  //                                       │ │
│ ...                                         │ │
│ 18 // THIS SOFTWARE IS PROVIDED...         │ │
│ 19 // AS IS AND ANY EXPRESS...             │ │
│ 20 // IMPLIED WARRANTIES...                │ │
│ ... (scroll to see lines 21-38)            │ │
│ 38 #endif // ...                           │[▼]
└─────────────────────────────────────────────┘
```

**Done When**: Browser confirms scrolling works for all content

---

### Task 4: Commit Changes
**Type**: Git
**Action**: Commit the scroll fix
**Files**: `SyntaxHighlighter.tsx`

**Steps**:
1. Stage changes: `git add src/components/playground/wizard/SyntaxHighlighter.tsx`
2. Commit with descriptive message
3. Reference Phase 24-01

**Commit Message**:
```
fix(24-01): Remove height constraint from SyntaxHighlighter to enable scrolling

Root cause: .syntax-highlighter had height:100%
- Child tried to match parent height (100%)
- Parent .file-content-wrapper has flex:1 and overflow:auto
- Child height:100% prevented parent overflow from triggering
- No scrollbar appeared even though content exceeded viewport

Solution: Remove height:100% from .syntax-highlighter
- Let child grow naturally without height constraint
- Parent .file-content-wrapper handles overflow scrolling
- When content exceeds parent's flexbox height, scrollbar appears
- Keep overflow:auto for horizontal scroll of long lines

Impact:
- File preview now scrolls vertically for long files
- Users can see all 38 lines (not just first 18-20)
- Horizontal scrolling works for wide lines
- Scrollbar appears in parent .file-content-wrapper
- Simple one-line CSS fix

Fixes: Phase 24-01 - File preview panel scroll behavior
```

**Verify**:
- ✅ Commit created successfully
- ✅ Commit message is descriptive
- ✅ References Phase 24-01

**Done When**: Changes committed to git

---

## Verification

**Overall Success Criteria**:
- ✅ Removed height:100% from .syntax-highlighter
- ✅ Verified scroll chain works correctly
- ✅ TypeScript compiles without errors
- ✅ Vertical scrolling works for long files
- ✅ Horizontal scrolling works for wide lines
- ✅ Scrollbar appears when needed
- ✅ Browser testing confirms functionality
- ✅ Changes committed to git

**Definition of Done**:
- Browser testing shows working scrollbar
- All 38 lines of gmock-matchers.h are scrollable
- Scrollbar appears in file preview panel
- Commit created with detailed explanation

---

## Output

Create `24-01-SUMMARY.md` with:

### What Was Completed
- ✅ Task 1: Removed height:100% from .syntax-highlighter
- ✅ Task 2: Verified scroll chain works correctly
- ✅ Task 3: Browser verification results
- ✅ Task 4: Changes committed

### Code Changes
```diff
# src/components/playground/wizard/SyntaxHighlighter.tsx

  .syntax-highlighter {
-   height: 100%;
    overflow: auto;
  }
```

### Verification Results
**Before Fix**:
- ❌ File preview did not scroll
- ❌ Could only see first ~18-20 lines
- ❌ No scrollbar visible
- ❌ All 38 lines rendered in DOM but not accessible

**After Fix**:
- ✅ File preview scrolls vertically
- ✅ All 38 lines accessible via scroll
- ✅ Scrollbar appears when content exceeds viewport
- ✅ Horizontal scrolling works for long lines
- ✅ Parent .file-content-wrapper handles scroll

### Technical Details
**Root Cause**:
- `.syntax-highlighter` had `height: 100%`
- Made child always match parent height
- Prevented parent's `overflow: auto` from triggering
- Scrollbar never appeared

**Solution**:
- Removed `height: 100%`
- Let child grow naturally
- Parent's `overflow: auto` triggers when content overflows
- Scrollbar appears in `.file-content-wrapper`

### Commits
- Commit hash and message

### Impact
- Users can scroll to see all file content
- Long files fully viewable (38+ lines)
- Simple one-line CSS fix (removed one line)
- No breaking changes

---

**Status**: ⬜ Not Started
**Next**: Execute this plan to fix file preview scroll
